{"version":3,"sources":["components/utils/upload.png","components/context/model-context.js","components/utils/dimension-hook.js","components/image/useDetector.js","components/image/Detection.js","components/video/useBoxRenderer.js","components/video/Video.js","components/realtime/useWebcam.js","components/realtime/Realtime.js","components/utils/Selector.js","components/utils/LoadingSpinner.js","App.js","index.js"],"names":["module","exports","ModelContext","createContext","model","fetchModel","labels","fetchLabels","selected","selectMode","useDimension","useState","window","innerWidth","height","width","dimensions","setDimensions","useEffect","handleResize","addEventListener","_","removeEventListener","getLabelText","prediction","scoreText","score","toFixed","class","calculateMaxScores","scores","numBoxes","numClasses","maxes","classes","i","max","Number","MIN_VALUE","index","j","buildDetectedObjects","boxes","indexes","count","length","objects","bbox","minY","minX","maxY","maxX","push","parseInt","renderPredictions","predictions","canvasRef","console","log","ctx","current","getContext","clearRect","canvas","font","textBaseline","forEach","x","y","strokeStyle","lineWidth","strokeRect","fillStyle","textWidth","measureText","textHeight","fillRect","fillText","detectFrame","imageRef","a","batched","tf","fromPixels","expandDims","shape","executeAsync","result","dataSync","dispose","maxScores","prevBackend","indexTensor","boxes2","nonMaxSuppression","useDetector","loadedImg","Detection","useContext","setLoadedImg","useRef","Fragment","className","accept","multiple","onDrop","accepted","rejected","links","reader","FileReader","readAsDataURL","src","alt","upload","style","display","ref","videoRef","img","resizeBilinear","toFloat","requestAnimationFrame","useBoxRenderer","shouldRender","Video","frame","setFrame","videoLoaded","setVideoLoaded","onloadeddata","autoPlay","playsInline","muted","useWebcam","webcamLoaded","setWebcamLoaded","navigator","mediaDevices","getUserMedia","audio","video","facingMode","then","stream","srcObject","onloadedmetadata","Realtime","cameraLoaded","Selector","onClick","LoadingSpinner","props","asOverlay","App","setModel","setLabels","loading","setLoading","setSelected","useCallback","loadModel","MODEL_URL","fetch","response","json","Provider","value","textAlign","color","fontWeight","fontSize","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.a301e1f3.chunk.js","sourcesContent":["module.exports = \"data:image/png;base64,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\"","import { createContext } from 'react';\r\n\r\nexport const ModelContext = createContext({\r\n    model: null,\r\n    fetchModel: (model) => {},\r\n    labels: null,\r\n    fetchLabels: (labels) => {},\r\n    selected: '',\r\n    selectMode: (selected) => {}\r\n});","import { useState, useEffect } from 'react';\r\n\r\nexport const useDimension = () => {\r\n    const [dimensions, setDimensions] = useState(() => { \r\n        if (window.innerWidth > 1000) {\r\n            return {\r\n                height: 650,\r\n                width: 900\r\n            }\r\n        } else if (window.innerWidth > 800) {\r\n            return {\r\n                height: 550,\r\n                width: 700\r\n            }\r\n        } else if (window.innerWidth > 600) {\r\n            return {\r\n                height: 400,\r\n                width: 500\r\n            }\r\n        } else if (window.innerWidth > 400) {\r\n            return {\r\n                height: 280,\r\n                width: 350\r\n            }\r\n        } else {\r\n            return {\r\n                height: 200,\r\n                width: 300\r\n            }\r\n        }\r\n    })\r\n\r\n    useEffect(() => {\r\n        function handleResize() {\r\n            if (window.innerWidth > 1000) {\r\n                setDimensions({\r\n                    height: 650,\r\n                    width: 900\r\n                })\r\n            } else if (window.innerWidth > 800) {\r\n                setDimensions({\r\n                    height: 550,\r\n                    width: 700\r\n                })\r\n            } else if (window.innerWidth > 600) {\r\n                setDimensions({\r\n                    height: 400,\r\n                    width: 500\r\n                })\r\n            } else if (window.innerWidth > 400) {\r\n                setDimensions({\r\n                    height: 280,\r\n                    width: 350\r\n                })\r\n            } else {\r\n                setDimensions({\r\n                    height: 200,\r\n                    width: 300\r\n                })\r\n            }\r\n        }\r\n\r\n        window.addEventListener('resize', handleResize)\r\n\r\n        return _ => {\r\n            window.removeEventListener('resize', handleResize)\r\n        }\r\n    });\r\n\r\n    return dimensions;\r\n}","import { useEffect } from 'react'\r\nimport * as tf from '@tensorflow/tfjs';\r\n\r\nconst SCORE_DIGITS = 4\r\n\r\nconst getLabelText = (prediction) => {\r\n    const scoreText = prediction.score.toFixed(SCORE_DIGITS)\r\n    return prediction.class + ', score: ' + scoreText\r\n}\r\n\r\nconst calculateMaxScores = (scores, numBoxes, numClasses) => {\r\n    const maxes = []\r\n    const classes = []\r\n    for (let i = 0; i < numBoxes; i++) {\r\n        let max = Number.MIN_VALUE\r\n        let index = -1\r\n        for (let j = 0; j < numClasses; j++) {\r\n        if (scores[i * numClasses + j] > max) {\r\n            max = scores[i * numClasses + j]\r\n            index = j\r\n        }\r\n        }\r\n        maxes[i] = max\r\n        classes[i] = index\r\n    }\r\n    return [maxes, classes]\r\n}\r\n\r\nconst buildDetectedObjects = (\r\n    width,\r\n    height,\r\n    boxes,\r\n    scores,\r\n    indexes,\r\n    classes,\r\n    labels\r\n    ) => {\r\n    const count = indexes.length\r\n    const objects = []\r\n    for (let i = 0; i < count; i++) {\r\n        const bbox = []\r\n        for (let j = 0; j < 4; j++) {\r\n        bbox[j] = boxes[indexes[i] * 4 + j]\r\n        }\r\n        const minY = bbox[0] * height\r\n        const minX = bbox[1] * width\r\n        const maxY = bbox[2] * height\r\n        const maxX = bbox[3] * width\r\n        bbox[0] = minX\r\n        bbox[1] = minY\r\n        bbox[2] = maxX - minX\r\n        bbox[3] = maxY - minY\r\n        objects.push({\r\n        bbox: bbox,\r\n        class: labels[parseInt(classes[indexes[i]])],\r\n        score: scores[indexes[i]]\r\n        })\r\n    }\r\n    return objects\r\n}\r\n\r\nconst renderPredictions = (predictions, canvasRef) => {\r\n    console.log(predictions)\r\n    const ctx = canvasRef.current.getContext('2d')\r\n    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height)\r\n    // Font options.\r\n    const font = '16px sans-serif'\r\n    ctx.font = font\r\n    ctx.textBaseline = 'top'\r\n    predictions.forEach(prediction => {\r\n        const x = prediction.bbox[0]\r\n        const y = prediction.bbox[1]\r\n        const width = prediction.bbox[2]\r\n        const height = prediction.bbox[3]\r\n        // console.log(x, y, width, height)\r\n        // Draw the bounding box.\r\n        ctx.strokeStyle = '#00FFFF'\r\n        ctx.lineWidth = 4\r\n        ctx.strokeRect(x, y, width, height)\r\n        // Draw the label background.\r\n        ctx.fillStyle = '#00FFFF'\r\n        const textWidth = ctx.measureText(getLabelText(prediction)).width\r\n        const textHeight = parseInt(font, 10) // base 10\r\n        ctx.fillRect(x, y, textWidth + 4, textHeight + 4)\r\n    })\r\n\r\n    predictions.forEach(prediction => {\r\n        const x = prediction.bbox[0]\r\n        const y = prediction.bbox[1]\r\n        // Draw the text last to ensure it's on top.\r\n        ctx.fillStyle = '#000000'\r\n        ctx.fillText(getLabelText(prediction), x, y)\r\n    })\r\n}\r\n\r\nconst detectFrame = async (model, labels, imageRef, canvasRef) => {\r\n    const batched = tf.tidy(() => {\r\n        const img = tf.browser.fromPixels(imageRef.current)\r\n        return img.expandDims(0);\r\n        // const small = tf.image.resizeBilinear(img, [500, 500]).div(255);\r\n        // // Reshape to a single-element batch so we can pass it to executeAsync.\r\n        // return small.expandDims(0).toFloat();\r\n    })\r\n\r\n    const height = batched.shape[1]\r\n    const width = batched.shape[2]\r\n    const result = await model.executeAsync(batched)\r\n    const scores = result[0].dataSync();\r\n    const boxes = result[1].dataSync()\r\n\r\n    // clean the webgl tensors\r\n    batched.dispose();\r\n    tf.dispose(result);\r\n    const [maxScores, classes] = calculateMaxScores(\r\n        scores,\r\n        result[0].shape[1],\r\n        result[0].shape[2]\r\n    )\r\n\r\n    const prevBackend = tf.getBackend()\r\n    // run post process in cpu\r\n    tf.setBackend('cpu')\r\n    const indexTensor = tf.tidy(() => {\r\n        const boxes2 = tf.tensor2d(boxes, [result[1].shape[1], result[1].shape[3]])\r\n        return tf.image.nonMaxSuppression(\r\n        boxes2,\r\n        maxScores,\r\n        20, // maxNumBoxes\r\n        0.5, // iou_threshold\r\n        0.5 // score_threshold\r\n        )\r\n    })\r\n\r\n    const indexes = indexTensor.dataSync()\r\n    indexTensor.dispose()\r\n    // restore previous backend\r\n    tf.setBackend(prevBackend)\r\n\r\n    const predictions = buildDetectedObjects(\r\n        width,\r\n        height,\r\n        boxes,\r\n        maxScores,\r\n        indexes,\r\n        classes,\r\n        labels\r\n    )\r\n\r\n    renderPredictions(predictions, canvasRef)\r\n}\r\n\r\nconst useDetector = (model, labels, loadedImg, imageRef, canvasRef) => {\r\n    useEffect(() => {\r\n        if (model && labels && loadedImg && imageRef) {\r\n            detectFrame(model, labels, imageRef, canvasRef)\r\n        }\r\n    }, [model, labels, loadedImg, imageRef, canvasRef])\r\n}\r\n\r\nexport default useDetector;","import React, {  useState, useRef, useContext } from 'react';\r\nimport { ModelContext } from '../context/model-context';\r\nimport { useDimension } from '../utils/dimension-hook';\r\nimport useDetector from './useDetector';\r\nimport MagicDropzone from 'react-magic-dropzone';\r\nimport upload from '../utils/upload.png';\r\n\r\nconst Detection = () => {\r\n    const { model, labels } = useContext(ModelContext);\r\n    const dimensions = useDimension();\r\n    const [loadedImg, setLoadedImg] = useState(null); \r\n    const imageRef = useRef();\r\n    const canvasRef = useRef();\r\n\r\n    useDetector(model, labels, loadedImg, imageRef, canvasRef)\r\n\r\n    const onDrop = (accepted, rejected, links) => {\r\n        if (accepted && accepted.length > 0) {\r\n            const reader = new FileReader();\r\n            reader.addEventListener(\"load\", () => {\r\n                setLoadedImg(reader.result);\r\n            });\r\n            reader.readAsDataURL(accepted[0]);\r\n        }\r\n    }\r\n\r\n    return (\r\n        <React.Fragment>\r\n                <div>\r\n                    <div className=\"center-div\">\r\n                        <div className=\"card\">\r\n                            <MagicDropzone className=\"dropzone\" accept=\"image/jpeg, image/png, .jpg, .jpeg, .png\" multiple={false} onDrop={onDrop}>\r\n                                <div className=\"center-div-wrap\">\r\n                                    {loadedImg ? (\r\n                                        <img className=\"dropzone-image\" src={loadedImg} width=\"100\" alt=\"drop\" />\r\n                                    ) : (\r\n                                        <div>\r\n                                            <div className=\"center-div\">\r\n                                                <img src={upload} width=\"50\" height=\"50\" alt=\"upload\" />\r\n                                            </div>\r\n                                            <div style={{ display: 'block' }}>\r\n                                                <p>Drag/drop files over here</p>\r\n                                            </div>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            </MagicDropzone>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"center-div\">\r\n                        {loadedImg && (\r\n                            <div style={{\r\n                                width: `${dimensions.width}px`,\r\n                                height: `${dimensions.height}px`,\r\n                            }}>\r\n                                <div className=\"image-container\">\r\n                                    <img \r\n                                        src={loadedImg} \r\n                                        width={dimensions.width}\r\n                                        height={dimensions.height} \r\n                                        className=\"image-canvas\"\r\n                                        ref={imageRef} \r\n                                        alt=\"ok\" \r\n                                    />\r\n                                    <canvas \r\n                                        width={dimensions.width}\r\n                                        height={dimensions.height} \r\n                                        className=\"image-canvas\" \r\n                                        ref={canvasRef}\r\n                                    />\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n        </React.Fragment>\r\n    )\r\n}\r\n\r\nexport default Detection;","import { useEffect } from 'react'\r\nimport * as tf from '@tensorflow/tfjs';\r\nimport { useDimension } from '../utils/dimension-hook';\r\n\r\nconst SCORE_DIGITS = 4\r\n\r\nconst getLabelText = (prediction) => {\r\n    const scoreText = prediction.score.toFixed(SCORE_DIGITS)\r\n    return prediction.class + ', score: ' + scoreText\r\n}\r\n\r\nconst calculateMaxScores = (scores, numBoxes, numClasses) => {\r\n  const maxes = []\r\n  const classes = []\r\n  for (let i = 0; i < numBoxes; i++) {\r\n    let max = Number.MIN_VALUE\r\n    let index = -1\r\n    for (let j = 0; j < numClasses; j++) {\r\n      if (scores[i * numClasses + j] > max) {\r\n        max = scores[i * numClasses + j]\r\n        index = j\r\n      }\r\n    }\r\n    maxes[i] = max\r\n    classes[i] = index\r\n  }\r\n  return [maxes, classes]\r\n}\r\n\r\nconst buildDetectedObjects = (\r\n  width,\r\n  height,\r\n  boxes,\r\n  scores,\r\n  indexes,\r\n  classes,\r\n  labels\r\n) => {\r\n  const count = indexes.length\r\n  const objects = []\r\n  for (let i = 0; i < count; i++) {\r\n    const bbox = []\r\n    for (let j = 0; j < 4; j++) {\r\n      bbox[j] = boxes[indexes[i] * 4 + j]\r\n    }\r\n    const minY = bbox[0] * height\r\n    const minX = bbox[1] * width\r\n    const maxY = bbox[2] * height\r\n    const maxX = bbox[3] * width\r\n    bbox[0] = minX\r\n    bbox[1] = minY\r\n    bbox[2] = maxX - minX\r\n    bbox[3] = maxY - minY\r\n    objects.push({\r\n      bbox: bbox,\r\n      class: labels[parseInt(classes[indexes[i]])],\r\n      score: scores[indexes[i]]\r\n    })\r\n  }\r\n  return objects\r\n}\r\n\r\nconst renderPredictions = (predictions, canvasRef) => {\r\n  const ctx = canvasRef.current.getContext('2d')\r\n  ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height)\r\n  // Font options.\r\n  const font = '16px sans-serif'\r\n  ctx.font = font\r\n  ctx.textBaseline = 'top'\r\n  predictions.forEach(prediction => {\r\n    const x = prediction.bbox[0]\r\n    const y = prediction.bbox[1]\r\n    const width = prediction.bbox[2]\r\n    const height = prediction.bbox[3]\r\n    // console.log(x, y, width, height)\r\n    // Draw the bounding box.\r\n    ctx.strokeStyle = '#00FFFF'\r\n    ctx.lineWidth = 4\r\n    ctx.strokeRect(x, y, width, height)\r\n    // Draw the label background.\r\n    ctx.fillStyle = '#00FFFF'\r\n    const textWidth = ctx.measureText(getLabelText(prediction)).width\r\n    const textHeight = parseInt(font, 10) // base 10\r\n    ctx.fillRect(x, y, textWidth + 4, textHeight + 4)\r\n  })\r\n\r\n  predictions.forEach(prediction => {\r\n    const x = prediction.bbox[0]\r\n    const y = prediction.bbox[1]\r\n    // Draw the text last to ensure it's on top.\r\n    ctx.fillStyle = '#000000'\r\n    ctx.fillText(getLabelText(prediction), x, y)\r\n  })\r\n}\r\n\r\nconst detectFrame = async (model, videoRef, canvasRef, labels, dimensions) => {\r\n  try {\r\n    // console.log(videoRef.current.width, videoRef.current.height)\r\n    const batched = tf.tidy(() => {\r\n      const img = tf.browser.fromPixels(videoRef.current)\r\n      const small = tf.image.resizeBilinear(img, [dimensions.height, dimensions.width])\r\n      // Reshape to a single-element batch so we can pass it to executeAsync.\r\n      return small.expandDims(0).toFloat();\r\n    })\r\n\r\n    const height = batched.shape[1]\r\n    const width = batched.shape[2]\r\n\r\n    const result = await model.executeAsync(batched)\r\n    const scores = result[0].dataSync();\r\n    const boxes = result[1].dataSync()\r\n\r\n    // clean the webgl tensors\r\n    batched.dispose();\r\n    tf.dispose(result);\r\n    const [maxScores, classes] = calculateMaxScores(\r\n      scores,\r\n      result[0].shape[1],\r\n      result[0].shape[2]\r\n    )\r\n\r\n    const prevBackend = tf.getBackend()\r\n    // run post process in cpu\r\n    tf.setBackend('cpu')\r\n    const indexTensor = tf.tidy(() => {\r\n      const boxes2 = tf.tensor2d(boxes, [result[1].shape[1], result[1].shape[3]])\r\n      return tf.image.nonMaxSuppression(\r\n        boxes2,\r\n        maxScores,\r\n        20, // maxNumBoxes\r\n        0.5, // iou_threshold\r\n        0.5 // score_threshold\r\n      )\r\n    })\r\n\r\n    const indexes = indexTensor.dataSync()\r\n    indexTensor.dispose()\r\n    // restore previous backend\r\n    tf.setBackend(prevBackend)\r\n\r\n    const predictions = buildDetectedObjects(\r\n      width,\r\n      height,\r\n      boxes,\r\n      maxScores,\r\n      indexes,\r\n      classes,\r\n      labels\r\n    )\r\n\r\n    renderPredictions(predictions, canvasRef)\r\n      \r\n    requestAnimationFrame(() => {\r\n      detectFrame(model, videoRef, canvasRef, labels, dimensions)\r\n    })\r\n  } catch(err) {}\r\n}\r\n\r\nconst useBoxRenderer = (model, videoRef, canvasRef, shouldRender, labels) => {\r\n  const dimensions = useDimension();\r\n\r\n  useEffect(() => {\r\n    if (model && labels && shouldRender) {\r\n      console.log(\"new video\");\r\n      detectFrame(model, videoRef, canvasRef, labels, dimensions)\r\n    }\r\n  }, [canvasRef, model, shouldRender, videoRef, labels, dimensions])\r\n}\r\n\r\nexport default useBoxRenderer\r\n","import React, { useState, useRef, useContext } from 'react';\r\nimport { ModelContext } from '../context/model-context';\r\nimport MagicDropzone from 'react-magic-dropzone';\r\nimport { useDimension } from '../utils/dimension-hook';\r\nimport useBoxRenderer from './useBoxRenderer';\r\nimport upload from '../utils/upload.png';\r\n\r\nconst Video = () => {\r\n    const { model, labels } = useContext(ModelContext);\r\n    const dimensions = useDimension();\r\n    const [frame, setFrame] = useState();\r\n    const [videoLoaded, setVideoLoaded] = useState(false);\r\n    const videoRef = useRef();\r\n    const canvasRef = useRef();\r\n\r\n    useBoxRenderer(model, videoRef, canvasRef, videoLoaded, labels)\r\n\r\n    const onDrop = (accepted, rejected, links) => {\r\n        setVideoLoaded(false);\r\n        if (accepted && accepted.length > 0) {\r\n            const reader = new FileReader();\r\n            reader.addEventListener(\"load\", () => {\r\n                videoRef.current.src = reader.result;\r\n                setFrame(`${reader.result}#t=0.1`)\r\n                videoRef.current.onloadeddata = () => {\r\n                    setVideoLoaded(true);\r\n                }\r\n            });\r\n            reader.readAsDataURL(accepted[0]);\r\n        }\r\n    }\r\n\r\n    return (\r\n        <React.Fragment>\r\n            <div>\r\n                <div className=\"center-div\">\r\n                    <div className=\"card\">\r\n                        <MagicDropzone className=\"dropzone\" accept=\"video/mp4, video/x-m4v, video/*\" multiple={false} onDrop={onDrop}>\r\n                            <div className=\"center-div-wrap\">\r\n                                {frame ? (\r\n                                    <video className=\"dropzone-image\" src={frame} width=\"100\" />\r\n                                ) : (\r\n                                    <div>\r\n                                        <div className=\"center-div\">\r\n                                            <img src={upload} width=\"50\" height=\"50\" alt=\"upload\" />\r\n                                        </div>\r\n                                        <div style={{ display: 'block' }}>\r\n                                            <p>Drag/drop files over here</p>\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </MagicDropzone>\r\n                    </div>\r\n                </div>\r\n                <div className=\"center-div\">\r\n                        <div style={{\r\n                            width: `${dimensions.width}px`,\r\n                            height: `${dimensions.height}px`,\r\n                        }}>\r\n                            <div className=\"image-container\">\r\n                                <video \r\n                                    autoPlay\r\n                                    playsInline\r\n                                    muted\r\n                                    width={dimensions.width}\r\n                                    height={dimensions.height} \r\n                                    className=\"image-canvas\"   \r\n                                    ref={videoRef} \r\n                                />\r\n                                <canvas \r\n                                    width={dimensions.width}\r\n                                    height={dimensions.height} \r\n                                    className=\"image-canvas\" \r\n                                    ref={canvasRef}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                </div>\r\n            </div>\r\n        </React.Fragment>\r\n    )\r\n}\r\n\r\nexport default Video;","import { useState, useEffect, useContext } from 'react'\r\nimport { ModelContext } from '../context/model-context';\r\n\r\nconst useWebcam = (model, videoRef) => {\r\n  const [webcamLoaded, setWebcamLoaded] = useState(false);\r\n  const { selected } = useContext(ModelContext);\r\n\r\n  useEffect(() => {\r\n    if (model && selected === 'Realtime') {\r\n      if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\r\n        navigator.mediaDevices\r\n          .getUserMedia({\r\n            audio: false,\r\n            video: {\r\n              facingMode: 'environment'\r\n            }\r\n          })\r\n          .then(stream => {\r\n            // window.stream = stream\r\n            videoRef.current.srcObject = stream\r\n            videoRef.current.onloadedmetadata = () => {\r\n              setWebcamLoaded(true)\r\n            }\r\n          })\r\n      }\r\n    }\r\n  }, [model, videoRef, selected])\r\n  return webcamLoaded\r\n}\r\n\r\nexport default useWebcam\r\n","import React, { useRef, useContext } from 'react';\r\nimport { ModelContext } from '../context/model-context';\r\nimport { useDimension } from '../utils/dimension-hook';\r\nimport useWebcam from './useWebcam';\r\nimport useBoxRenderer from '../video/useBoxRenderer';\r\n\r\nconst Realtime = () => {\r\n  const { model, labels } = useContext(ModelContext);\r\n  const dimensions = useDimension();\r\n  const videoRef = useRef()\r\n  const canvasRef = useRef()\r\n\r\n  const cameraLoaded = useWebcam(model, videoRef)\r\n  useBoxRenderer(model, videoRef, canvasRef, cameraLoaded, labels)\r\n\r\n  return (\r\n    <div>\r\n        <div className=\"center-div\">\r\n          <div style={{\r\n              width: `${dimensions.width}px`,\r\n              height: `${dimensions.height}px`,\r\n          }}>\r\n              <div className=\"image-container\">\r\n                  <video\r\n                      autoPlay\r\n                      playsInline\r\n                      muted\r\n                      ref={videoRef}\r\n                      width={dimensions.width}\r\n                      height={dimensions.height} \r\n                      className=\"image-canvas\"\r\n                  />\r\n                  <canvas \r\n                      width={dimensions.width}\r\n                      height={dimensions.height} \r\n                      className=\"image-canvas\" \r\n                      ref={canvasRef}\r\n                  />\r\n            </div>\r\n          </div>\r\n        </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default Realtime;","import React, { useContext } from 'react';\r\nimport { ModelContext } from '../context/model-context';\r\nimport Detection from '../image/Detection';\r\nimport Video from '../video/Video';\r\nimport Realtime from '../realtime/Realtime';\r\nimport './Selector.css';\r\n\r\nconst Selector = () => {\r\n    const { selected, selectMode } = useContext(ModelContext);\r\n\r\n    return (\r\n        <React.Fragment>\r\n            <div className=\"top-div\">\r\n                <div className=\"section-div\">\r\n                    {selected === 'Image' ? (\r\n                        <div className=\"selected-div\" onClick={() => selectMode('Image')}>\r\n                                <div className=\"selected-text\">Upload Image</div>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"deselected-div\" onClick={() => selectMode('Image')}> \r\n                                <div className=\"deselected-text\">Upload Image</div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n                \r\n                <div className=\"section-div\">\r\n                    {selected === 'Video' ? (\r\n                            <div className=\"selected-div\" onClick={() => selectMode('Video')}>\r\n                                <div className=\"selected-text\">Upload Video</div>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"deselected-div\"onClick={() => selectMode('Video')}> \r\n                                <div className=\"deselected-text\">Upload Video</div>\r\n                            </div>\r\n                        )}\r\n                </div>\r\n\r\n                <div className=\"section-div\">\r\n                    {selected === 'Realtime' ? (\r\n                        <div className=\"selected-div\" onClick={() => selectMode('Realtime')}>\r\n                                <div className=\"selected-text\">Open Camera</div>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"deselected-div\" onClick={() => selectMode('Realtime')}>\r\n                            <div className=\"deselected-text\">Open Camera</div>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {selected === 'Image' && (\r\n                <Detection />\r\n            )}\r\n            {selected === 'Video' && (\r\n                <Video />\r\n            )}\r\n            {selected === 'Realtime' && (\r\n                <Realtime />\r\n            )}\r\n\r\n        </React.Fragment>\r\n    )\r\n}\r\nexport default Selector;","import React from 'react';\r\nimport './LoadingSpinner.css';\r\n\r\nconst LoadingSpinner = props => {\r\n  return (\r\n    <div className={`${props.asOverlay && 'loading-spinner__overlay'}`}>\r\n      <div className=\"lds-roller\">\r\n        <div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default LoadingSpinner;","import React, { useState, useCallback } from 'react';\r\nimport * as tf from '@tensorflow/tfjs';\r\nimport { ModelContext } from './components/context/model-context';\r\nimport Selector from './components/utils/Selector';\r\nimport LoadingSpinner from './components/utils/LoadingSpinner';\r\n\r\nconst MODEL_URL = process.env.PUBLIC_URL + '/model/';\r\nconst LABELS_URL = MODEL_URL + 'labels.json';\r\nconst MODEL_JSON = MODEL_URL + 'model.json';\r\n\r\nconst App = () => {\r\n  const [model, setModel] = useState(null);\r\n  const [labels, setLabels] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [selected, setSelected] = useState('');\r\n\r\n  const fetchModel = useCallback((model) => {\r\n      setModel(model);\r\n  }, []);\r\n\r\n  const fetchLabels = useCallback((labels) => {\r\n      setLabels(labels);\r\n  }, []);\r\n\r\n  const selectMode = useCallback((selected) => {\r\n      setSelected(selected)\r\n  }, [])\r\n\r\n  const loadModel = async () => {\r\n    setLoading(true);\r\n    const model = await tf.loadGraphModel(MODEL_JSON);\r\n    fetchModel(model);\r\n    const response = await fetch(LABELS_URL);\r\n    let labels = await response.json();\r\n    fetchLabels(labels)\r\n    setLoading(false);\r\n  }\r\n\r\n  return (\r\n      <ModelContext.Provider \r\n        value={{\r\n          model: model, \r\n          fetchModel: fetchModel, \r\n          labels: labels, \r\n          fetchLabels: fetchLabels,\r\n          selected: selected,\r\n          selectMode: selectMode\r\n        }}>\r\n          <div className=\"header-div\">\r\n            This currently uses SSD + Mobilenetv2 pretrained coco model\r\n          </div>\r\n          <div>\r\n            {model ? (\r\n              <div>\r\n                <Selector />\r\n              </div>\r\n            ) : (\r\n              <div className=\"center-div load-div\">\r\n                  {loading ? (\r\n                    <div style={{ textAlign: 'center' }}>\r\n                      <LoadingSpinner />\r\n                      <p style={{\r\n                        color: '#6e00b8',\r\n                        fontWeight: '500',\r\n                      }}>Loading Model. Please wait a few seconds...</p>\r\n                    </div>\r\n                  ) : (\r\n                    <button className=\"css-btn\" style={{ width: '60%' }} onClick={loadModel}>\r\n                      <p style={{ fontSize: '16px', fontWeight: '500' }}>Load Model</p>\r\n                    </button>\r\n                  )}\r\n              </div>\r\n            )}\r\n          </div>\r\n      </ModelContext.Provider>\r\n  );\r\n}\r\n\r\nexport default App;\r\n\r\n\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n"],"sourceRoot":""}